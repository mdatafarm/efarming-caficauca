@model EFarming.Core.ComercialModule.Shipment

@{
    ViewBag.Title = "Create";
    Layout = "~/Views/Shared/_Layout.cshtml";
}

<link href="~/Content/themes/base/all.css" rel="stylesheet" />

<div class="wrapper wrapper-content">
    <div class="row">
        <div class="col-lg-12">
            <div class="ibox float-e-margins">
                <div class="ibox-title">
                    <h5>Create Shipment</h5>
                </div>
                <div class="ibox-content">
                    <div class="flot-chart farm-search">
                        <div class="row">
                            <div class="col-lg-12">
                                @using (Html.BeginForm())
                                {
                                    @Html.AntiForgeryToken()
                                    <div class="row">
                                        <div class="col-md-7">
                                            <h3>Lots in this Shipment</h3>
                                            <table class="table table-bordered col-md-8">
                                                <tr>
                                                    <th>Internal Reference</th>
                                                    <th>Ico Mark</th>
                                                    @foreach (var item in ViewBag.referencesList)
                                                    {
                                                        <th>@item.Name</th>
                                                    }
                                                </tr>
                                                @foreach (var itemLot in ViewBag.Lots)
                                                {
                                                    <input type="hidden" value="@itemLot.lot.Id" name="Lots" />
                                                    <tr>
                                                        <td>@itemLot.lot.LotReference</td>
                                                        <td>@itemLot.lot.IcoMark</td>
                                                        @foreach (var itemref in ViewBag.referencesList)
                                                        {
                                                            foreach (var itemLotRef in itemLot.references)
                                                            {
                                                                if (itemref.Id == itemLotRef.DocumentReference.Id)
                                                                {
                                                                    <td>@itemLotRef.Value</td>
                                                                }
                                                            }
                                                        }
                                                    </tr>
                                                }
                                            </table>
                                        </div>
                                        <div class="col-md-4">
                                            <div class="panel panel-default">
                                                <div class="panel-heading">
                                                    <h4>Shipment Information</h4>
                                                </div>
                                                <div class="panel-body">
                                                    <div class="form-horizontal">
                                                        @Html.ValidationSummary(true, "", new { @class = "text-danger" })
                                                        <div class="form-group">
                                                            <div class="control-label col-md-5">B/L</div>
                                                            <div class="col-md-7">
                                                                @Html.EditorFor(model => model.DocumentBL, new { htmlAttributes = new { @class = "form-control" } })
                                                                @Html.ValidationMessageFor(model => model.DocumentBL, "", new { @class = "text-danger" })
                                                            </div>
                                                        </div>

                                                        <div class="form-group">
                                                            <div class="control-label col-md-5">Shipping date</div>
                                                            <div class="col-md-7">
                                                                @Html.EditorFor(model => model.ShippingDate, new { htmlAttributes = new { @class = "form-control" } })
                                                                @Html.ValidationMessageFor(model => model.ShippingDate, "", new { @class = "text-danger" })
                                                            </div>
                                                        </div>

                                                        <div class="form-group">
                                                            <div class="control-label col-md-5">Shipment port</div>
                                                            <div class="col-md-7">
                                                                @Html.EditorFor(model => model.PortOfLanding, new { htmlAttributes = new { @class = "form-control" } })
                                                                @Html.ValidationMessageFor(model => model.PortOfLanding, "", new { @class = "text-danger" })
                                                            </div>
                                                        </div>

                                                        <div class="form-group">
                                                            <div class="control-label col-md-5">Port of destination</div>
                                                            <div class="col-md-7">
                                                                @Html.EditorFor(model => model.PortOfDestination, new { htmlAttributes = new { @class = "form-control" } })
                                                                @Html.ValidationMessageFor(model => model.PortOfDestination, "", new { @class = "text-danger" })
                                                            </div>
                                                        </div>

                                                        <div class="form-group">
                                                            <div class="control-label col-md-5">Vessel</div>
                                                            <div class="col-md-7">
                                                                @Html.EditorFor(model => model.Vessel, new { htmlAttributes = new { @class = "form-control" } })
                                                                @Html.ValidationMessageFor(model => model.Vessel, "", new { @class = "text-danger" })
                                                            </div>
                                                        </div>

                                                        <div class="form-group">
                                                            <div class="control-label col-md-5">Shipping line</div>
                                                            <div class="col-md-7">
                                                                @Html.EditorFor(model => model.ShippingLine, new { htmlAttributes = new { @class = "form-control" } })
                                                                @Html.ValidationMessageFor(model => model.ShippingLine, "", new { @class = "text-danger" })
                                                            </div>
                                                        </div>

                                                        <div class="form-group">
                                                            <div class="control-label col-md-5">Expocafé invoice</div>
                                                            <div class="col-md-7">
                                                                @Html.EditorFor(model => model.ExpocafeInvoice, new { htmlAttributes = new { @class = "form-control" } })
                                                                @Html.ValidationMessageFor(model => model.ExpocafeInvoice, "", new { @class = "text-danger" })
                                                            </div>
                                                        </div>

                                                        @if (ViewBag.Contract.SellerId == new Guid("{9FD591FB-D3E4-49C8-A7EE-458472AECCB7}"))
                                                        {
                                                            <div class="form-group">
                                                                <div class="control-label col-md-5">Receipt invoice date</div>
                                                                <div class="col-md-7">
                                                                    @Html.Editor("invoiceReceipt", new { htmlAttributes = new { @class = "form-control", @value = "2015-01-01" } })
                                                                </div>
                                                            </div>
                                                        }

                                                        @*<div class="form-group">
                                                                <div class="control-label col-md-3">
                                                                    Lots list
                                                                </div>
                                                                <div class="col-md-9">
                                                                    @Html.Hidden("Lots", ViewBag.Lots)
                                                                    @Html.DropDownList("Lots", ViewBag.Lots as IEnumerable<SelectListItem>, htmlAttributes: new { multiple = "multiple", @class = "form-control" })
                                                                </div>
                                                            </div>*@

                                                        @*<input type="hidden" value="@ViewBag.LotsId" name="Lots" />*@

                                                        <div class="form-group">
                                                            <div class="col-md-offset-6 col-md-6">
                                                                <input type="submit" value="Create" class="btn btn-success btn-lg" />
                                                            </div>
                                                        </div>
                                                    </div>
                                                </div>
                                                <div class="panel-footer">
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                }
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<script src="~/Scripts/jquery-ui-1.10.4.min.js"></script>
<script type="text/javascript">

    $("#ShippingDate").datepicker({
        changeMonth: true,
        changeYear: true,
        dateFormat: "yy-mm-dd",
        beforeShow: function (input, inst) {
            var rect = input.getBoundingClientRect();
            setTimeout(function () {
                inst.dpDiv.css({ top: rect.top + 40, left: rect.left + 0 });
            }, 0);
        }
    });

    $("#invoiceReceipt").datepicker({
        changeMonth: true,
        changeYear: true,
        dateFormat: "yy-mm-dd",
        beforeShow: function (input, inst) {
            var rect = input.getBoundingClientRect();
            setTimeout(function () {
                inst.dpDiv.css({ top: rect.top + 40, left: rect.left + 0 });
            }, 0);
        }
    });

</script>
