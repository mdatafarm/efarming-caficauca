
@{
    ViewBag.Title = "Dashboard";
    Layout = "~/Views/Shared/_Layout.cshtml";
}
<div class="row wrapper border-bottom white-bg page-heading">
    <div class="col-lg-10">
        <h2 class="page-name">Dashboard por evaluaciones</h2>
        <ol class="breadcrumb">
            <li>
                <a href="@Url.Action("Index", "AssessmentTemplates")">
                    Sostenibilidad
                </a>
            </li>
            <li>
                <a href="@Url.Action("Index", "AssessmentTemplates")">
                    Evaluaciones
                </a>
            </li>
            <li>
                <a href="@Url.Action("DashboardHome", "AssessmentTemplates")">
                    Dashboard Home
                </a>
            </li>
            <li class="active">
                <strong>Dashboard por @ViewBag.name</strong>
            </li>
        </ol>
    </div>
</div>
@*<script src="~/Scripts/highcharts/6.1.1/export-data.js"></script>
    <script src="~/Scripts/highcharts/6.1.1/exporting.js"></script>*@
<script src="~/Scripts/highcharts/6.1.1/highcharts.js"></script>
<script src="~/Scripts/jquery-ui-1.10.4.min.js"></script>
<script src="~/Scripts/dashboard/DashboardFarm.js"></script>
<script src="~/Scripts/dashboard/Common.js"></script>
<link href="~/Scripts/jquery.loading/jquery.loading.min.css" rel="stylesheet" />
<script src="~/Scripts/jquery.loading/jquery.loading.min.js"></script>
<script type="text/javascript">
                    var selectedCountry = "";
                    var selectedSupplier = "";
                    var selectedSupplyChain = "";
                    var selectedDepartment = "@ViewBag.CurrentDepartment";
                    var selectedMunicipality = "@ViewBag.CurrentMunicipality";
                    var selectedVillage = "@ViewBag.CurrentVillage";
                    var selectedFarmStatus = "";
                    var selectedFarmSubstatus = "";
                    var selectedCooperative = "";
                    var selectedOwnershipType = "";
                    var selectedCode = "@ViewBag.CurrentCode";
                    var selectedName = "@ViewBag.CurrentName";
                    var selectedFarmerName = "@ViewBag.CurrentFarmerName";
                    var selectedFarmerIdentification = "@ViewBag.CurrentFarmerIdentification";
                    var selectedLongitude = "";
                    var selectedLatitude = "";
                    var selectedElevation = "";
                    var selectedAssociatedPeople = "";
                    var selectedOption = "";

</script>
<script type="text/javascript" src="http://maps.google.com/maps/api/js?sensor=true"></script>
<script src="~/Scripts/mvvm/Common.js"></script>
<!--<script type="text/javascript" src="~/Scripts/mvvm/farm.js"></script>-->

<script type="text/javascript">

    $(function () {
        $("#accordion").accordion();
    });
    var selectedId = "@ViewBag.id";


    function search() {
            
            //if (selectedId == 'be690312-2132-41ca-83e6-049b58e37d90') {
            //// Modulos
            //    var url = "../../../api/Farms/ByModule?startDate=" + $("#start").val() + "&endDate=" + $("#end").val() + "&id=" + selectedId + "&moduname=" + "Ambiental" + "&Department=" + $('#searchDepartment').val() + "&Municipality=" + $('#searchMunicipality').val() + "&Village=" + $('#searchVillage').val();
            //    BasicColumns(url, 'ByModule1');
           
            //    var url = "../../../api/Farms/ByModule?startDate=" + $("#start").val() + "&endDate=" + $("#end").val() + "&id=" + selectedId + "&moduname=" + "Social" + "&Department=" + $('#searchDepartment').val() + "&Municipality=" + $('#searchMunicipality').val() + "&Village=" + $('#searchVillage').val();           
            //    BasicColumns(url, 'ByModule2');

            //    var url = "../../../api/Farms/ByModule?startDate=" + $("#start").val() + "&endDate=" + $("#end").val() + "&id=" + selectedId + "&moduname=" + "Calidad" + "&Department=" + $('#searchDepartment').val() + "&Municipality=" + $('#searchMunicipality').val() + "&Village=" + $('#searchVillage').val();
            //    BasicColumns(url, 'ByModule3');

            ////Submodulos
            //    var url = "/api/Farms/BySubModule?startDate=" + $("#start").val() + "&endDate=" + $("#end").val() + "&id=" + selectedId + "&moduname=" + "Ambiental" + "&Department=" + $('#searchDepartment').val() + "&Municipality=" + $('#searchMunicipality').val() + "&Village=" + $('#searchVillage').val() + "&aux=" + 0;
            //    BasicColumns(url, 'BySubModule1');

            //    var url = "/api/Farms/BySubModule?startDate=" + $("#start").val() + "&endDate=" + $("#end").val() + "&id=" + selectedId + "&moduname=" + "Social" + "&Department=" + $('#searchDepartment').val() + "&Municipality=" + $('#searchMunicipality').val() + "&Village=" + $('#searchVillage').val() + "&aux=" + 0;
            //    BasicColumns(url, 'BySubModule2');

            //    var url = "/api/Farms/BySubModule?startDate=" + $("#start").val() + "&endDate=" + $("#end").val() + "&id=" + selectedId + "&moduname=" + "Calidad" + "&Department=" + $('#searchDepartment').val() + "&Municipality=" + $('#searchMunicipality').val() + "&Village=" + $('#searchVillage').val() + "&aux=" + 0;
            //    BasicColumns(url, 'BySubModule3');
            //}

            //else if (selectedId == '30d2c6e1-b38c-44a5-b63c-76d0f41328ef') {
            //// Modulos
            //    var url = "../../../api/Farms/ByModule?startDate=" + $("#start").val() + "&endDate=" + $("#end").val() + "&id=" + selectedId + "&moduname=" + "Kit Mr Espresso" + "&Department=" + $('#searchDepartment').val() + "&Municipality=" + $('#searchMunicipality').val() + "&Village=" + $('#searchVillage').val();
            //    BasicColumns(url, 'ByModule1');
            ////Submodulos
            //    var url = "/api/Farms/BySubModule?startDate=" + $("#start").val() + "&endDate=" + $("#end").val() + "&id=" + selectedId + "&moduname=" + "Kit Mr Espresso" + "&Department=" + $('#searchDepartment').val() + "&Municipality=" + $('#searchMunicipality').val() + "&Village=" + $('#searchVillage').val() + "&aux=" + 0;
            //    BasicColumns(url, 'BySubModule1');
            //}

           // else if (selectedId == '627d3079-2181-42d8-923e-a5db47d1e052') {
            // Modulos
                var url = "../../../api/Farms/ByModule?startDate=" + $("#start").val() + "&endDate=" + $("#end").val() + "&id=" + selectedId  + "&Department=" + $('#searchDepartment').val() + "&Municipality=" + $('#searchMunicipality').val() + "&Village=" + $('#searchVillage').val();
                BasicColumns(url, 'ByModule1');

                //var url = "../../../api/Farms/ByModule?startDate=" + $("#start").val() + "&endDate=" + $("#end").val() + "&id=" + selectedId + "&moduname=" + "Recompensas" + "&Department=" + $('#searchDepartment').val() + "&Municipality=" + $('#searchMunicipality').val() + "&Village=" + $('#searchVillage').val();
                //BasicColumns(url, 'ByModule2');
            //Submodulos
                var url = "/api/Farms/BySubModule?startDate=" + $("#start").val() + "&endDate=" + $("#end").val() + "&id=" + selectedId + "&Department=" + $('#searchDepartment').val() + "&Municipality=" + $('#searchMunicipality').val() + "&Village=" + $('#searchVillage').val() + "&aux=" + 0;
                BasicColumns(url, 'BySubModule1');

                //var url = "/api/Farms/BySubModule?startDate=" + $("#start").val() + "&endDate=" + $("#end").val() + "&id=" + selectedId + "&moduname=" + "Recompensas" + "&Department=" + $('#searchDepartment').val() + "&Municipality=" + $('#searchMunicipality').val() + "&Village=" + $('#searchVillage').val() + "&aux=" + 0;
                //BasicColumns(url, 'BySubModule2');
        //}
        //TimelineBysubModule 
        var url = "/api/Farms/TimelineBysubModule?Asid=" + selectedId + "&Department=" + $('#searchDepartment').val() + "&Municipality=" + $('#searchMunicipality').val() + "&Village=" + $('#searchVillage').val() + "&IniDate=" + $("#start").val() + "&EndDate=" + $("#end").val();
        BasicColumns(url, 'TimeLineBySubModule');

        //BySubModuleGAP
        var url = "/api/Farms/BySubModuleGAP?GAPId=" + selectedId + "&InitialDate=" + $("#start").val() + "&endDate=" + $("#end").val() + "&Department=" + $('#searchDepartment').val() + "&Municipality=" + $('#searchMunicipality').val() + "&Village=" + $('#searchVillage').val();
        BasicColumns(url, 'SubModuleGAP');

       
    }
    
    function GetMunicipalitiesList(DepartmentId) {
	    var procemessage = "<option value='0'> Please wait...</option>";
        $("#searchMunicipality").html(procemessage).show();

	    var url = '@Url.Action("getMucipalitiesByDepartment")';
        $.ajax({
        url: url,
        data: { dep:DepartmentId },
        cache: false,
        type: "POST",
        success: function (data) {
        var markup = "<option value='0'>Select Municipality</option>";
        for (var i = 0; i < data.length; i++) {
        markup += "<option value=" + data[i].Value + ">" + data[i].Text + "</option>";
        }
        $("#searchMunicipality").html(markup).show();
        },
        error: function (reponse) {
        //alert("error : " + reponse);
        }
        });

        }

    function GetVillagesList(NameMunicipality) {
        var procemessage = "<option value='0'> Please wait...</option>";
        $("#searchVillage").html(procemessage).show();

        var url = '@Url.Action("getVillagesByMunicipality")';

        $.ajax({
        url: url,
        data: { mun: NameMunicipality },
        cache: false,
        type: "POST",
        success: function (data) {
        var markup = "<option value='0'>Select Village</option>";
        for (var i = 0; i < data.length; i++) {
            markup += "<option value=" + data[i].Value + ">" + data[i].Text + "</option>";
        }
        $("#searchVillage").html(markup).show();
        },
        error: function (reponse) {
        alert("error : " + reponse);
        }
        });

        }
        /*DropDown end */

</script>

<link href="~/Content/themes/base/all.css" rel="stylesheet" />

<div class="wrapper wrapper-content" id="tabItemDashboard">
    <div class="row">
        <div class="col-lg-12">
            <div class="ibox float-e-margins">
                <div class="ibox-title">
                    <!--<h5>Dashboard by farm</h5>-->
                </div>
                <div class="ibox-content">
                    <div class="flot-chart farm-search">
                        <div class="row">
                            <div class="col-md-12">
                                
                                    <form role="form" class="filter-form" data-bind="with: farm">
                                        <div class="row-fluid">
                                            <div class="col-lg-6 col-sm-6">
                                                <div style="text-align:center;">
                                                    <div class="form-group">
                                                        <label for="year">Fecha inicio</label>
                                                        <input type="date" id="start" name="start" class="form-control" value="@ViewBag.start.ToString("yyyy-MM-dd")" style="width:60%; text-align-last:center;display: block; margin-left: auto; margin-right: auto; text-align-last:center;" />
                                                    </div>
                                                </div>
                                                <div style="text-align:center;">
                                                    <label for="searchDepartment" class="hidden-xs"> Departamento</label>
                                                    <!--Inicio Select-->
                                                    @Html.DropDownList("searchDepartment", ViewBag.Departments as SelectList, "Please select a department", new { @class = "form-control", @id = "searchDepartment", style = "width:60%; text-align-last:center;display: block; margin-left: auto; margin-right: auto;", @onchange = "javascript:GetMunicipalitiesList(this.value);", @onclick = "javascript:GetMunicipalitiesList(this.value);" })
                                                    @*Lugares*@
                                                </div>
                                                <div style="text-align:center;">
                                                    <label for="searchVillage" class="hidden-xs"> Vereda</label>
                                                    <!--Inicio Select-->
                                                    <select id="searchVillage" name="searchVillage" class="form-control" style="width:60%; text-align-last:center;display: block; margin-left: auto; margin-right: auto; text-align-last:center;"></select>
                                                    @*Lugares*@
                                                </div>
                                            </div>
                                            <div class="col-lg-6 col-sm-6">
                                                <div style="text-align:center;">
                                                    <div class="form-group">
                                                        <label for="year">Fecha fin</label>
                                                        <input type="date" id="end" name="end" class="form-control" value="@ViewBag.end.ToString("yyyy-MM-dd")" style="width:60%; text-align-last:center;display: block; margin-left: auto; margin-right: auto; text-align-last:center;" />
                                                    </div>
                                                </div>
                                                <div style="text-align:center;">
                                                    <label for="searchMunicipality" class="hidden-xs"> Municipio</label>
                                                    <!--Inicio Select-->
                                                    <select id="searchMunicipality" name="searchMunicipality" class="form-control" style="width:60%; text-align-last:center;display: block; margin-left: auto;  margin-right: auto; text-align-last:center;" value=ViewBag.CurrentMunicipality onchange="javascript:GetVillagesList(this.value);"></select>

                                                    @*Lugares*@
                                                </div>
                                                
                                            </div>

                                            </div>

                                    </form>
                                    <div>
                                        <br />
                                        <br />
                                    </div>
                                
                                    <div class="row">
                                        <div div class="col-md-12 text-center" style="margin-top:15px">
                                            <button id="btnsearch" type="button" class="btn btn-success" onclick="search()"> Buscar</button>
                                        </div>
                                    </div>
                            </div>
                        </div>
                        <div class="row" id="charts">
                            <hr />
                            <div class="col-lg-12">
                                <div id="accordion">
                                    <h1><a href="#1">Categorías</a></h1>
                                    <div id="Modules">
                                        <div class="row">
                                         <div class="col-lg-12">
                                            <div class="ibox float-e-margins">
                                                <div class="ibox-content" style="display: block;">
                                                    <div class="flot-chart">

                                                        <div class="charts" id="ByModule1">
                                                        </div>


                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                        </div>
                                        <div class="row">
                                            <div class="col-lg-12">
                                                <div class="ibox float-e-margins">
                                                    <div class="ibox-content" style="display: block;">
                                                        <div class="flot-chart">

                                                            <div class="charts" id="ByModule2">
                                                            </div>


                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="row">
                                            <div class="col-lg-12">
                                                <div class="ibox float-e-margins">
                                                    <div class="ibox-content" style="display: block;">
                                                        <div class="flot-chart">
                                                            <div class="charts" id="ByModule3">
                                                            </div>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    <h1><a href="#2">Sub Categoría</a></h1>
                                    <div id="SubModules">
                                        <div class="row">
                                            <div class="col-lg-12">
                                                <div class="ibox float-e-margins">
                                                    <div class="ibox-content" style="display: block;">
                                                        <div class="flot-chart">
                                                            <div class="charts" id="BySubModule1">
                                                            </div>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="row">
                                            <div class="col-lg-12">
                                                <div class="ibox float-e-margins">
                                                    <div class="ibox-content" style="display: block;">
                                                        <div class="flot-chart">
                                                            <div class="charts" id="BySubModule2">
                                                            </div>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="row">
                                            <div class="col-lg-12">
                                                <div class="ibox float-e-margins">
                                                    <div class="ibox-content" style="display: block;">
                                                        <div class="flot-chart">
                                                            <div class="charts" id="BySubModule3">
                                                            </div>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    <h1><a href="#3">Línea de tiempo por Sub Categoría</a></h1>
                                    <div id="TimeLineSubModules">
                                        <div class="row">
                                            <div class="col-lg-12">
                                                <div class="ibox float-e-margins">
                                                    <div class="ibox-content" style="display: block;">
                                                        <div class="flot-chart">
                                                            <div class="charts" id="TimeLineBySubModule">
                                                            </div>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>

                                    </div>
                                    <h1><a href="#3">Sub Categoría GAP</a></h1>
                                    <div id="SubModulesGAP">
                                        <div class="row">
                                            <div class="col-lg-12">
                                                <div class="ibox float-e-margins">
                                                    <div class="ibox-content" style="display: block;">
                                                        <div class="flot-chart">
                                                            <div class="charts" id="SubModuleGAP">
                                                            </div>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>

                                    </div>
                                </div>
                                @*<div class="row">
            <div class="col-lg-12">
                <div class="ibox float-e-margins">
                    <div class="ibox-content" style="display: block;">
                        <div class="flot-chart">
                            <div class="charts" id="TimelineBySubModule">
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div class="row">
            <div class="col-lg-12">
                <div class="ibox float-e-margins">
                    <div class="ibox-content" style="display: block;">
                        <div class="flot-chart">
                            <div class="charts" id="GAPBySubModule">
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>*@
                            </div>
                            </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>



@*<script>
    function BasicColumns(url, component) {
        console.log(component + "url en basic columns1" + url);
        $('#' + component).loading({
            stoppable: true
        });
        $.get(url, function (result) {
            console.log("url en basic columns2" + url);
            var objJSON = JSON.parse(result);
            Highcharts.chart(component, objJSON);
            $('#' + component).loading('stop');
        });
    }
</script>*@