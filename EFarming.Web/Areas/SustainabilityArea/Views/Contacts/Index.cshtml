@*@model IEnumerable<EFarming.Core.SustainabilityModule.ContactAggregate.Contact>*@
@using EFarming.DTO.QualityModule;
@using PagedList.Mvc;

@model PagedList.IPagedList<EFarming.Core.SustainabilityModule.ContactAggregate.Contact>
@{
    ViewBag.Title = "Index";
    Layout = "~/Views/Shared/_Layout.cshtml";
}

@*<link href="~/Content/themes/base/all.css" rel="stylesheet" />

    @section Scripts {
        <script src="~/Scripts/jquery-ui-1.10.4.min.js"></script>
        <script src="~/Scripts/Sustainability/ContactFilter.js"></script>
    }
*@
@section breadcrumb{
    <div class="row wrapper border-bottom white-bg page-heading">
        <div class="col-lg-10">
            <h2 class="page-name">Contactos</h2>
            <ol class="breadcrumb">
                <li>
                    <a href="@Url.Action("Index", "Home")">
                        Home
                    </a>
                </li>
                <li>
                    <a href="@Url.Action("AssessmentTemplates", "SustainabilityArea")">
                        Sostenibilidad
                    </a>
                </li>
                <li class="active">
                    <strong>Contactos</strong>
                </li>
            </ol>
        </div>
        <div class="col-lg-2">
        </div>
    </div>
}


<div id="spa-table">
    <div class="wrapper wrapper-content">
        <div class="row wrapper border-bottom white-bg page-heading">
            <div class="ibox-content">
                <div class="flot-chart farm-search">
                    <div class="col-md-12 text-center" style="margin-top:15px" align="center">
                        <div class="col-md-2" align="center">
                            @if (!User.IsInRole("Reader"))
                            {
                                <a class="btn btn-success" align="center" style="margin: 10px 15px;" href="@Url.Action("Create","Contacts")">
                                    <em class="glyphicon glyphicon-plus" align="center"></em> Crear Contacto
                                </a>
                            }
                        </div>
                    </div>

                    <!--Code ini-->
                    <div class="container-fluid">
                        <div class="row">
                            <form role="form" class="filter-form" data-bind="with: QualityReports">

                                <div class="col-lg-6 col-sm-6">

                                    <div style="text-align:center;">
                                        <label for="year" class="hidden-xs">Fecha inicial</label>
                                        <input type="date" id="searchStartDate" name="searchStartDate" class="form-control" value="@ViewBag.currentStartDate" style="width:60%; text-align-last:center;display: block; margin-left: auto; margin-right: auto; text-align-last:center;" />
                                    </div>
                                </div>
                                <div class="col-lg-6 col-sm-6">
                                    <div style="text-align:center;" class="form-group">
                                        <label for="year" class="hidden-xs">Fecha final</label>
                                        <input type="date" id="searchEndDate" name="searchEndDate" class="form-control" value="@ViewBag.currentEndDate" style="width:60%; text-align-last:center;display: block; margin-left: auto; margin-right: auto; text-align-last:center;" />
                                    </div>
                                </div>


                                <div class="col-lg-6 col-sm-6">
                                    <div style="text-align:center;">
                                        <label for="searchDepartment" class="hidden-xs"> Departamento </label>
                                        @Html.DropDownList("searchDepartment", ViewBag.Departments as SelectList, "Please select a department", new { @class = "form-control", @id = "searchDepartment", style = "width:60%; text-align-last:center;display: block; margin-left: auto; margin-right: auto;", @onchange = "javascript:GetMunicipalitiesList(this.value);", @onclick = "javascript:GetMunicipalitiesList(this.value);" })
                                    </div>



                                    <div style="text-align:center;">
                                        <label for="searchVillage" class="hidden-xs"> Vereda </label>
                                        <!--Inicio Select-->
                                        <select id="searchVillage" name="searchVillage" class="form-control" style="width:60%; text-align-last:center;display: block; margin-left: auto; margin-right: auto; text-align-last:center;"></select>
                                        @*Lugares*@
                                    </div>
                                    <div style="text-align:center;">
                                        <label for="year">Código Finca</label>
                                        <input type="text" id="searchFarmCode" name="searchFarmCode" class="form-control" style="width:60%; text-align-last:center;display: block; margin-left: auto; margin-right: auto;" />
                                    </div>
                                </div>
                                <div class="col-lg-6 col-sm-6">
                                    <div style="text-align:center;">
                                        <label for="searchMunicipality" class="hidden-xs"> Municipio </label>
                                        <!--Inicio Select-->
                                        <select id="searchMunicipality" name="searchMunicipality" class="form-control" style="width:60%; text-align-last:center;display: block; margin-left: auto; margin-right: auto; text-align-last:center;" onchange="javascript:GetVillagesList(this.value);"></select>
                                        @*Lugares*@
                                    </div>
                                    <div style="text-align:center;">
                                        <label for="searchTaster" class="hidden-xs">Técnicos</label>
                                        <!--Inicio Select-->
                                        @Html.DropDownList("searchTechnician", ViewBag.Technicians as SelectList, "Please select a technician", new { @class = "form-control", @id = "searchTechnician", @name = "searchTechnician", style = "width:60%; text-align-last:center;display: block; margin-left: auto; margin-right: auto;" })
                                        @*Lugares*@
                                    </div>

                                    <div style="text-align:center;">
                                        <button class="btn btn-success btn-xs-12 btn-sf">
                                            <span class="glyphicon glyphicon-search"></span>
                                            Buscar
                                        </button>
                                        
                                    </div>
                                </div>

                                <br />
                                <br />
                            </form>

                            <!--Code end-->
                            <!--</div>
                            </div>
                        </div>
                    </div>
                    -->
                            <div class="col-md-12 col-lg-12 col-sm-12">
                                <div>
                                    <div style="width:20%; text-align-last:center;display: block; margin-left: auto; margin-right: auto; text-align-last:center;">
                                        <br />

                                        <label for="InputSearchQualTast" class="hidden-xs">Búsqueda rápida</label>
                                        <input class="form-control" id="InputSearchContacts" type="text" placeholder="Buscar..">

                                        <br />
                                    </div>
                                </div>
                                <table class="table-responsive table-condensed table-hover">
                                    <!--<table class="table table-striped  table-hover table-condensed">-->
                                    <thead>
                                        <tr class="filters">

                                            <!--<th class="col-md-1">Date</th>-->
                                            <th>@Html.ActionLink("Fecha", "Index", new { sortOrder = ViewBag.DateSortParm, searchStartDate = ViewBag.currentStartDate, searchEndDate = ViewBag.currentEndDate, searchDepartment = ViewBag.CurrentDepartment, searchMunicipality = ViewBag.CurrentMunicipality, searchVillage = ViewBag.CurrentVillage }) </th>
                                            <th>Nombre</th>
                                            <th>Código Finca</th>
                                            <th>Fincas</th>
                                            <th>@Html.ActionLink("Técnico", "Index", new { sortOrder = ViewBag.FarmManagerSortParm, searchStartDate = ViewBag.currentStartDate, searchEndDate = ViewBag.currentEndDate, searchDepartment = ViewBag.CurrentDepartment, searchMunicipality = ViewBag.CurrentMunicipality, searchVillage = ViewBag.CurrentVillage }) </th>
                                            <!--<th class="col-md-1">User name</th>-->
                                            <th>Ubicación</th>
                                            <th>Tipo</th>
                                            <th>Temas</th>
                                            <th><span class="glyphicon glyphicon-cog"></span></th>
                                            <th></th>
                                        </tr>
                                    </thead>
                                    <tbody id="TableContacts">
                                        @foreach (var contact in Model)
                                        {
                                            <tr>
                                                <td>
                                                    @string.Format("{0:dd/MM/yyyy}", contact.Date)
                                                </td>
                                                <td>
                                                    @contact.Name
                                                </td>
                                                <td>
                                                    <ul style="list-style-type: none; padding:0">
                                                        @foreach (var farm in contact.Farms)
                                                        {
                                                            <li>@farm.Code</li>
                                                        }
                                                    </ul>
                                                </td>
                                                <td>
                                                    <ul style="list-style-type: none; padding:0">
                                                        @foreach (var farm in contact.Farms)
                                                        {
                                                            <li>@farm.Name</li>
                                                        }
                                                    </ul>
                                                </td>
                                                <td>
                                                    @contact.User.FirstName @contact.User.LastName
                                                </td>
                                                <td>
                                                    @contact.Location.Name
                                                </td>
                                                <td>
                                                    @contact.Type.Name
                                                </td>
                                                <td>
                                                    <ul style="list-style-type: none; padding:0">
                                                        @foreach (var topic in contact.Topics)
                                                        {
                                                            <li>@topic.Name</li>
                                                        }
                                                    </ul>
                                                </td>
                                                <td>
                                                    <a href="@Url.Action("Edit", new { id = contact.Id })"><span class="glyphicon glyphicon-edit"></span></a>
                                                    <a href="@Url.Action("Details", new { id = contact.Id })"><span class="glyphicon glyphicon-file"></span></a>
                                                    <a href="@Url.Action("Delete", new { id = contact.Id })"><span class="glyphicon glyphicon-remove"></span></a>
                                                </td>
                                            </tr>
                                        }
                                    </tbody>

                                </table>

                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <!--Paginación-->
            <div class="text-center">
                @string.Format("", (Model.PageCount < Model.PageNumber ? 0 : Model.PageNumber), Model.PageCount)
            </div>
            <div class="pagination-container">
                <div class="text-center">
                    @Html.PagedListPager(Model, page => Url.Action("Index",
                        new
                        {
                            page,
                            sortOrder = ViewBag.CurrentSort,
                            currentStartDate = ViewBag.currentStartDate,
                            currentEndDate =ViewBag.currentEndDate,
                            currentDepartment = ViewBag.CurrentDepartment,
                            currentMunicipality = ViewBag.CurrentMunicipality,
                            currentVillage = ViewBag.CurrentVillage,
                            currentTechnician = ViewBag.CurrentTechnician
                            //currentCode = ViewBag.CurrentCode
                        }))
                </div>
            </div>
            <!--Paginación end-->
        </div>
    </div>
    
</div>
<script src="~/Scripts/jquery-ui-1.10.4.min.js">
</script>
<script>
        /*Dropdown start */

        $(document).ready(function () {


            $("#InputSearchContacts").on("keyup", function () {
                var value = $(this).val().toLowerCase();
                $("#TableContacts tr").filter(function () {
                    $(this).toggle($(this).text().toLowerCase().indexOf(value) > -1)
                });
            });


        });

    function GetMunicipalitiesList(DepartmentId) {
	    var procemessage = "<option value='0'> Please wait...</option>";
        $("#searchMunicipality").html(procemessage).show();

	    var url = '@Url.Action("getMucipalitiesByDepartment")';



        $.ajax({
        url: url,
        data: { dep:DepartmentId },
        cache: false,
        type: "POST",
        success: function (data) {
        var markup = "<option value='0'>Select Municipality</option>";
        for (var i = 0; i < data.length; i++) {
        markup += "<option value=" + data[i].Value + ">" + data[i].Text + "</option>";
        }
        $("#searchMunicipality").html(markup).show();
        },
        error: function (reponse) {
        //alert("error : " + reponse);
        }
        });

        }

        function GetVillagesList(NameMunicipality) {
        var procemessage = "<option value='0'> Please wait...</option>";
        $("#searchVillage").html(procemessage).show();

        var url = '@Url.Action("getVillagesByMunicipality")';



        $.ajax({
        url: url,
        data: { mun: NameMunicipality },
        cache: false,
        type: "POST",
        success: function (data) {
        var markup = "<option value='0'>Select Village</option>";
        for (var i = 0; i < data.length; i++) {
        markup += "<option value=" + data[i].Value + ">" + data[i].Text + "</option>";
        }
        $("#searchVillage").html(markup).show();
        },
        error: function (reponse) {
        alert("error : " + reponse);
        }
        });

        }
        /*DropDown end */
</script>
<link href="~/Content/themes/base/all.css" rel="stylesheet" />
<script>
    $(document).ready(function () {
        $("#InputSearchContacts").on("keyup", function () {
            var value = $(this).val().toLowerCase();
            $("#TableContacts tr").filter(function () {
                $(this).toggle($(this).text().toLowerCase().indexOf(value) > -1)
            });
        });
    });
</script>

<script>
    $(document).ready(function () {


        $("#InputSearchQualTast").on("keyup", function () {
            var value = $(this).val().toLowerCase();
            $("#TableQualTast tr").filter(function () {
                $(this).toggle($(this).text().toLowerCase().indexOf(value) > -1)
            });
        });


    });
</script>

