@model PagedList.IPagedList<EFarming.Core.FarmModule.FarmAggregate.Farm>
@using PagedList.Mvc;
@{
    ViewBag.Title = FarmMessages.Title;
    int counter = 0;
}

@section breadcrumb{
    <div class="row wrapper border-bottom white-bg page-heading">
        <div class="col-lg-12">
            <center>
                <h2 class="page-name">Resumen Fincas</h2>
            </center>
        </div>
    </div>
}

<div class="wrapper wrapper-content">
    <div class="row">
        <div class="col-lg-12">
            <div class="ibox float-e-margins">
                <div class="ibox-title">
                    <h5>@FarmMessages.Search_Farms</h5>
                    <div class="ibox-tools">
                        <a href="#" data-toggle="dropdown" class="dropdown-toggle">
                            <i class="fa fa-bars"></i>
                        </a>
                        <ul class="dropdown-menu dropdown-user dropdown-menu-right">
                            <li>
                                <a href="#">@Message.Export_Filter</a>
                            </li>
                            <li>
                                <a href="#">@Message.Export_All</a>
                            </li>
                        </ul>
                    </div>
                </div>
                <div class="ibox-content">
                    <div class="flot-chart farm-search">
                        <div class="row">
                            <div class="col-lg-12">
                                <form role="form" class="filter-form" data-bind="with: farm">
                                    <div class="row-fluid">
                                        <div class="col-lg-6 col-sm-6">

                                            <div class="form-group">
                                                <label for="searchDepartment" class="hidden-xs">@AdminMessage.Department</label>
                                                <select data-bind="value: department, options: $root.departments, optionsText:'name', optionsValue:'id',optionsCaption: '@string.Format(Message.SelectA, AdminMessage.Department)', event:{change:$root.getMunicipalities}" name="searchDepartment" id="searchDepartment" class="form-control"></select>
                                            </div>

                                            <div class="form-group">
                                                <label for="searchMunicipality" class="hidden-xs">@AdminMessage.Municipality</label>
                                                <select data-bind="value: municipality, options: $root.municipalities, optionsText:'name', optionsValue:'id',optionsCaption: '@string.Format(Message.SelectA, AdminMessage.Municipality)', event:{change: $root.getVillages}" name="searchMunicipality" id="searchMunicipality" class="form-control"></select>
                                            </div>

                                            <div class="form-group">
                                                <label for="searchVillage" class="hidden-xs">@AdminMessage.Village</label>
                                                <select data-bind="value: village, options: $root.villages, optionsText:'name', optionsValue:'id',optionsCaption: '@string.Format(Message.SelectA, AdminMessage.Village)'" name="searchVillage" id="searchVillage" class="form-control"></select>
                                            </div>

                                            <div class="form-group">
                                                <label for="searchFarmerName" class="hidden-xs ">@Message.Farmer_Name</label>
                                                <input type="text" placeholder="@Message.Farmer_Name" data-bind="value: farmerName" class="form-control" name="searchFarmerName" id="searchFarmerName">
                                            </div>
                                        </div>
                                        <div class="clo-lg-6 col-sm-6">
                                            <div class="form-group">
                                                <label for=" primary-code" class="hidden-xs">@FarmMessages.Name</label>
                                                <input type="text" placeholder="@FarmMessages.Name" data-bind="value: name" class="form-control" name="searchName" id="searchName">
                                            </div>

                                            <div class="form-group">
                                                <label for=" primary-code" class="hidden-xs ">@FarmMessages.Code</label>
                                                <input type="text" placeholder="@FarmMessages.Code" data-bind="value: code" class="form-control" name="searchCode" id="searchCode">
                                            </div>

                                            <div class="form-group">
                                                <button class="btn btn-success pull-right btn-sf">
                                                    <span class="glyphicon glyphicon-search"></span>
                                                    @Message.Search
                                                </button>
                                            </div>
                                        </div>

                                    </div>
                                </form>
                            </div>
                        </div>
                        <hr />
                        <div class="row">
                            <div class="col-lg-12">
                                <div class="table-responsive">

                                    @if (ViewBag.filter == 1)
                                    {
                                        <table class="table table-striped  table-hover table-condensed">
                                            <thead>
                                                <tr>
                                                    <th>
                                                        @Html.ActionLink("Código", "Index", new { sortOrder = ViewBag.CodeSortParm, currentName = ViewBag.currentName, CurrentCode = ViewBag.CurrentCode, CurrentFarmerName = ViewBag.CurrentFarmerName, CurrentFarmerIdentification = ViewBag.CurrentFarmerIdentification, CurrentVillage = ViewBag.CurrentVillage, CurrentMunicipality = ViewBag.CurrentMunicipality, CurrentDepartment = ViewBag.CurrentDepartment })
                                                    </th>
                                                    <th>
                                                        @Html.ActionLink("Nombre de finca", "Index", new { sortOrder = ViewBag.NameSortParm, currentName = ViewBag.currentName, CurrentCode = ViewBag.CurrentCode, CurrentFarmerName = ViewBag.CurrentFarmerName, CurrentFarmerIdentification = ViewBag.CurrentFarmerIdentification, CurrentVillage = ViewBag.CurrentVillage, CurrentMunicipality = ViewBag.CurrentMunicipality, CurrentDepartment = ViewBag.CurrentDepartment })
                                                    </th>
                                                    <th>
                                                        Productor
                                                    </th>
                                                    <th>@Message.Actions</th>
                                                </tr>
                                            </thead>
                                            <tbody>
                                                @foreach (var farm in Model)
                                                {
                                                    <tr>
                                                        <td>
                                                            <a href="@Url.Action("Edit", "Farms", new { id = farm.Id })">
                                                                @Html.DisplayFor(modelItem => farm.Code)
                                                            </a>
                                                        </td>
                                                        <td>
                                                            <a href="@Url.Action("Edit", "Farms", new { id = farm.Id })">
                                                                @Html.DisplayFor(modelItem => farm.Name)
                                                            </a>
                                                        </td>
                                                        <td>
                                                            @Html.DisplayFor(modelItem => farm.FamilyUnitMembers.Where(c => c.IsOwner == true).FirstOrDefault().Identification) - @Html.DisplayFor(modelItem => farm.FamilyUnitMembers.Where(c => c.IsOwner == true).FirstOrDefault().FirstName) @Html.DisplayFor(modelItem => farm.FamilyUnitMembers.Where(c => c.IsOwner == true).FirstOrDefault().LastName)
                                                        </td>
                                                        <td>
                                                            <a href="/Farms/ExportPDFSummaryFarms?code=@farm.Id" target="_blank" class="img img-responsive">
                                                                <img src="~/Images/pdf1.png" alt="PDF" />
                                                            </a>
                                                        </td>
                                                    </tr>
                                                }
                                            </tbody>
                                        </table>
                                        <div class="text-center">

                                            @string.Format(Message.Paging, (Model.PageCount < Model.PageNumber ? 0 : Model.PageNumber), Model.PageCount)

                                        </div>
                                        <div class="pagination-container">
                                            <div class="text-center">

                                                @Html.PagedListPager(Model, page => Url.Action("Index",
                                                 new
                                                 {
                                                     page,
                                                     sortOrder = ViewBag.CurrentSort,
                                                     currentName = ViewBag.CurrentName,
                                                     currentDepartment = ViewBag.CurrentDepartment,
                                                     currentMunicipality = ViewBag.CurrentMunicipality,
                                                     currentVillage = ViewBag.CurrentVillage,
                                                     currentCode = ViewBag.CurrentCode
                                                 }));
                                            </div>
                                        </div>
                                    }


                                </div>
                            </div>
                        </div>

                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

@section Scripts{
    <script type="text/javascript">
        var selectedCountry = "";
        var selectedSupplier = "";
        var selectedSupplyChain = "";
        var selectedDepartment = "@ViewBag.CurrentDepartment";
        var selectedMunicipality = "@ViewBag.CurrentMunicipality";
        var selectedVillage = "@ViewBag.CurrentVillage";
        var selectedFarmStatus = "";
        var selectedFarmSubstatus = "";
        var selectedCooperative = "";
        var selectedOwnershipType = "";
        var selectedCode = "@ViewBag.CurrentCode";
        var selectedName = "@ViewBag.CurrentName";
        var selectedFarmerName = "@ViewBag.CurrentFarmerName";
        var selectedFarmerIdentification = "@ViewBag.CurrentFarmerIdentification";
        var selectedLongitude = "";
        var selectedLatitude = "";
        var selectedElevation = "";
        var selectedAssociatedPeople = "";
        var selectedOption = "";
    </script>
    <script type="text/javascript" src="http://maps.google.com/maps/api/js?sensor=true"></script>
    <script src="~/Scripts/mvvm/Common.js"></script>
    <script type="text/javascript" src="~/Scripts/mvvm/farm.js"></script>
}