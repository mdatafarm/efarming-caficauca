@using PagedList.Mvc;
@using PagedList;
@model EFarming.DTO.FarmModule.FarmDTO

@{
    int count = 0;
    double totalWeight = 0d;
    double totalPrice = 0d;
    double totalYield = 0d;
    double totalBags = 0d;
}

<div class="ibox float-e-margins">
    <div class="ibox-title">
        <h5>Resumen de ventas</h5>
    </div>
    <div class="ibox-content">
        <table class="table table-hover table-condensed table-striped">
            <thead>
                <tr>
                    <th>Año</th>
                    <th>Ventas totales (kg)</th>
                    <th>Valor total ($)</th>
                    <th>Precio promedio</th>
                </tr>
            </thead>
            <tbody>
                @foreach (EFarming.Web.Controllers.InvoicesController.groupedInvoice invoice in ViewBag.groupedInvoices)
                {
                    <tr>
                        <td>@invoice.Year</td>
                        <td>@String.Format("{0:#,##0}", invoice.Totalkg)</td>
                        <td>@String.Format("{0:#,##0}", invoice.TotalValue)</td>
                        <td>@String.Format("{0:#,##0}", invoice.AverageValue)</td>
                    </tr>
                }
            </tbody>
        </table>
    </div>
</div>

<div class="ibox float-e-margins">
    <div class="ibox-title">
        <h5>Detalle de ventas</h5>
    </div>
    <div class="ibox-content">
        <table class="table table-hover table-condensed table-striped">
            <thead>
                <tr>
                    <th>@Message.Date</th>
                    <th>Número de factura</th>
                    <th>@Message.Identification</th>
                    <th>@TraceabilityMessage.Weight (Kg)</th>
                    <th>Precio</th>
                    <th>Valor</th>
                    @*<th>
                            <span class="pull-right">
                                <a href="@Url.Action("Create", "Invoices", new { farmId = Model.Id, page = ((IPagedList<EFarming.DTO.TraceabilityModule.InvoiceDTO>)ViewBag.PagedInvoices).PageNumber })" data-toggle="modal" data-target="#modal" class="btn btn-success btn-sm">
                                    <span class="glyphicon glyphicon-plus">
                                    </span>
                                    @TraceabilityMessage.New_Invoice
                                </a>
                            </span>
                        </th>*@
                </tr>
            </thead>
            <tbody>
                @foreach (var invoice in (IPagedList<EFarming.DTO.TraceabilityModule.InvoiceDTO>) ViewBag.PagedInvoices)
                {
                    <tr>
                        <td>@string.Format("{0:dd/MM/yyyy}", Convert.ToDateTime(invoice.Date))</td>
                        <td>@invoice.InvoiceNumber</td>
                        <td>@invoice.Identification</td>
                        <td>@String.Format("{0:#,##0}", invoice.Weight)</td>
                        <td>@String.Format("{0:#,##0}", invoice.BaseKg)</td>
                        <td>@String.Format("{0:#,##0}", invoice.Value)</td>
                        @*<td>
                                <span class="pull-right">
                                    <a href="@Url.Action("Edit", "Invoices", new { id = invoice.Id, farmId = invoice.FarmId, page = ((IPagedList<EFarming.DTO.TraceabilityModule.InvoiceDTO>)ViewBag.PagedInvoices).PageNumber })" data-toggle="modal" data-target="#modal" class="btn btn-link link-edit">
                                        <span class="glyphicon glyphicon-edit"></span>
                                        @Message.Edit
                                    </a>
                                    <a href="@Url.Action("Delete", "Invoices", new { id = invoice.Id, farmId = invoice.FarmId, page = ((IPagedList<EFarming.DTO.TraceabilityModule.InvoiceDTO>)ViewBag.PagedInvoices).PageNumber })" data-toggle="modal" data-target="#modal" class="btn btn-link link-delete">
                                        <span class="glyphicon glyphicon-remove-sign"></span>
                                        @Message.Delete
                                    </a>
                                </span>
                            </td>*@
                    </tr>

                    count++;
                    totalWeight += invoice.Weight;
                    totalPrice += invoice.Value;
                }
            </tbody>
            <tfoot>
                <tr>
                    @{

                    }
                    <th></th>
                    <th></th>
                    <th></th>
                    <th>@string.Format("{0:#,##0}", totalWeight)</th>
                    <th></th>
                    <th>@string.Format("{0:#,##0}", totalPrice)</th>
                    <th></th>
                </tr>
            </tfoot>
        </table>
    </div>
    @*@Html.PagedListPager((IPagedList<EFarming.DTO.TraceabilityModule.InvoiceDTO>)ViewBag.PagedInvoices,
    page => Url.Action("Details", "Invoices", new { page, farmId = Model.Id}),
            PagedListRenderOptions.EnableUnobtrusiveAjaxReplacing(new System.Web.Mvc.Ajax.AjaxOptions() { HttpMethod = "GET", UpdateTargetId = "invoices-content" }))*@
</div>

<style>
    table th {
        text-align: center;
    }

    table td {
        text-align: center;
    }

    .pagination-container {
        text-align: center;
    }
</style>

<script src="~/Scripts/Pagination.js"></script>
@*<script src="~/Scripts/mvvm/invoice.js"></script>*@
